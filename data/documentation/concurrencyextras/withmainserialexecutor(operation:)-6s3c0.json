{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/ConcurrencyExtras\/documentation\/ConcurrencyExtras\/withMainSerialExecutor(operation:)-6s3c0"},"metadata":{"roleHeading":"Function","symbolKind":"func","externalID":"s:17ConcurrencyExtras22withMainSerialExecutor9operationyyyYaKYAXE_tYaKF","modules":[{"name":"ConcurrencyExtras"}],"title":"withMainSerialExecutor(operation:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"withMainSerialExecutor"},{"kind":"text","text":"("},{"kind":"externalParam","text":"operation"},{"kind":"text","text":": () "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"preciseIdentifier":"s:s4Voida","kind":"typeIdentifier","text":"Void"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"rethrows"}],"role":"symbol"},"sections":[],"primaryContentSections":[{"kind":"declarations","declarations":[{"platforms":["macOS"],"tokens":[{"kind":"attribute","text":"@"},{"preciseIdentifier":"s:ScM","kind":"attribute","text":"MainActor"},{"kind":"text","text":" "},{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"withMainSerialExecutor"},{"kind":"text","text":"("},{"kind":"externalParam","text":"operation"},{"kind":"text","text":": @isolated(any) () "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"preciseIdentifier":"s:s4Voida","kind":"typeIdentifier","text":"Void"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"rethrows"}],"languages":["swift"]}]},{"kind":"parameters","parameters":[{"content":[{"type":"paragraph","inlineContent":[{"text":"An operation to be performed on the main serial executor.","type":"text"}]}],"name":"operation"}]},{"kind":"content","content":[{"type":"heading","level":2,"text":"Discussion","anchor":"discussion"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Some asynchronous code is "},{"isActive":true,"type":"reference","identifier":"https:\/\/forums.swift.org\/t\/reliably-testing-code-that-adopts-swift-concurrency\/57304"},{"type":"text","text":" "},{"type":"text","text":"to test in Swift due to how suspension points are processed by the runtime. This function"},{"type":"text","text":" "},{"type":"text","text":"attempts to run all tasks spawned in the given operation serially and deterministically. It"},{"type":"text","text":" "},{"type":"text","text":"makes asynchronous tests faster and less flakey."}]},{"code":["await withMainSerialExecutor {","  \/\/ Everything performed in this scope is performed serially...","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"See "},{"isActive":true,"type":"reference","identifier":"doc:\/\/ConcurrencyExtras\/documentation\/ConcurrencyExtras\/ReliablyTestingAsync"},{"type":"text","text":" for more information on why this tool is needed to test"},{"type":"text","text":" "},{"type":"text","text":"async code and how to use it."}]},{"type":"aside","style":"warning","name":"Warning","content":[{"type":"paragraph","inlineContent":[{"text":"This API is only intended to be used from tests to make them more reliable. Please do","type":"text"},{"text":" ","type":"text"},{"text":"not use it from application code.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"We say that it “","type":"text"},{"inlineContent":[{"type":"text","text":"attempts"}],"type":"emphasis"},{"text":" to run all tasks spawned in an operation serially and","type":"text"},{"text":" ","type":"text"},{"text":"deterministically” because under the hood it relies on a global, mutable variable in the Swift","type":"text"},{"text":" ","type":"text"},{"text":"runtime to do its job, and there are no scoping ","type":"text"},{"inlineContent":[{"type":"text","text":"guarantees"}],"type":"emphasis"},{"text":" should this mutable variable change","type":"text"},{"text":" ","type":"text"},{"text":"during the operation.","type":"text"}]}]}]}],"schemaVersion":{"patch":0,"major":0,"minor":3},"abstract":[{"type":"text","text":"Perform an operation on the main serial executor."}],"hierarchy":{"paths":[["doc:\/\/ConcurrencyExtras\/documentation\/ConcurrencyExtras"]]},"kind":"symbol","variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/concurrencyextras\/withmainserialexecutor(operation:)-6s3c0"]}],"references":{"https://forums.swift.org/t/reliably-testing-code-that-adopts-swift-concurrency/57304":{"url":"https:\/\/forums.swift.org\/t\/reliably-testing-code-that-adopts-swift-concurrency\/57304","type":"link","title":"notoriously difficult","identifier":"https:\/\/forums.swift.org\/t\/reliably-testing-code-that-adopts-swift-concurrency\/57304","titleInlineContent":[{"type":"text","text":"notoriously"},{"text":" ","type":"text"},{"text":"difficult","type":"text"}]},"doc://ConcurrencyExtras/documentation/ConcurrencyExtras/withMainSerialExecutor(operation:)-6s3c0":{"kind":"symbol","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"withMainSerialExecutor"},{"kind":"text","text":"("},{"kind":"externalParam","text":"operation"},{"kind":"text","text":": () "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","preciseIdentifier":"s:s4Voida","text":"Void"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"rethrows"}],"title":"withMainSerialExecutor(operation:)","role":"symbol","identifier":"doc:\/\/ConcurrencyExtras\/documentation\/ConcurrencyExtras\/withMainSerialExecutor(operation:)-6s3c0","type":"topic","abstract":[{"type":"text","text":"Perform an operation on the main serial executor."}],"url":"\/documentation\/concurrencyextras\/withmainserialexecutor(operation:)-6s3c0"},"doc://ConcurrencyExtras/documentation/ConcurrencyExtras":{"url":"\/documentation\/concurrencyextras","kind":"symbol","role":"collection","type":"topic","abstract":[{"type":"text","text":"Useful, testable Swift concurrency."}],"identifier":"doc:\/\/ConcurrencyExtras\/documentation\/ConcurrencyExtras","title":"ConcurrencyExtras"},"doc://ConcurrencyExtras/documentation/ConcurrencyExtras/ReliablyTestingAsync":{"kind":"article","title":"Reliably testing async code","role":"article","identifier":"doc:\/\/ConcurrencyExtras\/documentation\/ConcurrencyExtras\/ReliablyTestingAsync","type":"topic","abstract":[{"type":"text","text":"Learn how to use the tools of this library to write reliable, deterministic tests for your async"},{"text":" ","type":"text"},{"text":"Swift code.","type":"text"}],"url":"\/documentation\/concurrencyextras\/reliablytestingasync"}}}